#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdbool.h>
#include <sys/mman.h>

// look at this non-contrived win function!
void win(unsigned int arg) {
    char filebuf[64];
    bool correct = false;
    if (arg == 0xdeadbeef) {
        strcpy(filebuf, "flag.txt");
        correct = true;
    }
    if (correct) {
        FILE* flagfile = fopen(filebuf, "r");
        if (flagfile == NULL) {
            puts("Couldn't read flag file. Try connecting to the server to run instead.");
        } else {
            char buf[256];
            fgets(buf, 256, flagfile);
            buf[strcspn(buf, "\n")] = '\0';
            puts("Here's the flag:");
            puts(buf);
        }
    } else {
        printf("Incorrect! arg: 0x%08x\n", arg);
    }
    fflush(stdout);
}

int main(void) {
    // look at this non-contrived leak!
    printf("addr of win: %p\n", win);
    printf("please enter input: ");
    fflush(stdout);
    char buf[64];
    // look at this non-contrived overflow!
    // and look at this non-contrived length number that definitely isn't an opcode!
    fgets(buf, 0xc35f, stdin);
    return 0;
}
