#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdbool.h>
#include <sys/mman.h>

int magic = 0;

void win(int arg) {
    char filebuf[64];
    bool correct = false;
    if (magic == 0x13371337 && arg == 0x12345678) {
        strcpy(filebuf, "flag.txt");
        correct = true;
    }
    if (correct) {
        FILE* flagfile = fopen(filebuf, "r");
        if (flagfile == NULL) {
            puts("Couldn't read flag file. Try connecting to the server to run instead.");
        } else {
            char buf[256];
            fgets(buf, 256, flagfile);
            buf[strcspn(buf, "\n")] = '\0';
            puts("Here's the flag:");
            puts(buf);
        }
    } else {
        printf("Incorrect! magic: 0x%08x, arg: 0x%08x\n", magic, arg);
    }
}

int main(void) {
    setbuf(stdout, NULL);
    char* input = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, 0, 0);
    printf("addr of win: %p\n", win);
    printf("addr of input: %p\n", input);
    printf("addr of magic: figure it out :D\n");
    printf("please enter input: ");
    fflush(stdout);
    fgets(input, 0x1000, stdin);
    printf("please enter more input: ");
    fflush(stdout);
    char buf[64];
    fgets(buf, 0x64, stdin);
    return 0;
}
